<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>DÃ©tails du livre â€” DAAR</title>
</head>

<body>

    <div class="page-wrapper">

        <h1 class="montype">DÃ©tail du livre</h1>

        <div id="book-container" class="book-detail-container">
            <p>Chargement...</p>
        </div>

        <h2 class="section-title">Suggestions</h2>

        <div id="suggestions" class="suggestions-grid">
            <p>Chargement...</p>
        </div>

        <p class="button" onclick="window.location.href='findbooks.html'">Retour Ã  la recherche</p>

    </div><!-- end page-wrapper -->

    <script>
        const API_BASE = "http://127.0.0.1:8000";
            
        function getParam(name) {
            return new URLSearchParams(window.location.search).get(name);
        }
        
        async function loadBook() {
            const docId = getParam("id");
            if (!docId) return;
        
            const res = await fetch(`${API_BASE}/book/${docId}`);
        
            if (!res.ok) {
                document.getElementById("book-container").innerHTML =
                    "<p style='color:red'>Erreur : impossible de charger le livre.</p>";
                return;
            }
        
            const data = await res.json();
        
            const container = document.getElementById("book-container");
        
            const imgSrc = data.cover_url 
                ? data.cover_url 
                : "https://via.placeholder.com/200x300?text=No+Cover";
        
            container.innerHTML = `
                <div class="detail-wrapper">
                    <img src="${imgSrc}" class="detail-cover">
                
                    <div class="detail-info">
                        <h2>${data.title ?? "Titre inconnu"}</h2>
                        <p><strong>Auteur :</strong> ${data.author ?? "Inconnu"}</p>
                        <p><strong>ID :</strong> ${docId}</p>
                        <p><strong>TÃ©lÃ©chargements :</strong> ${data.downloads ?? "?"}</p>
                    
                        <a href="https://www.gutenberg.org/ebooks/${docId}"
                           target="_blank"
                           class="read-button">
                            ðŸ“– Lire ce livre
                        </a>
                    </div>
                </div>
            `;
        }
        
        async function loadSuggestions() {
            const docId = getParam("id");
            if (!docId) return;
        
            const res = await fetch(`${API_BASE}/suggest/${docId}`);
        
            const container = document.getElementById("suggestions");
        
            if (!res.ok) {
                container.innerHTML = "<p style='color:red'>Impossible de charger les suggestions.</p>";
                return;
            }
        
            const data = await res.json();
            container.innerHTML = "";
        
            if (!data.length) {
                container.innerHTML = "<p>Aucune suggestion trouvÃ©e.</p>";
                return;
            }
        
            data.forEach(book => {
                const imgSrc = book.cover_url
                    ? book.cover_url
                    : "https://via.placeholder.com/100x150?text=No+Cover";
            
                const div = document.createElement("div");
                div.className = "suggest-card";
                div.onclick = () => {
                    window.location.href = `detail.html?id=${book.doc_id}`;
                };
            
                div.innerHTML = `
                    <img src="${imgSrc}" class="suggest-cover">
                    <div class="suggest-title">${book.title}</div>
                    <div class="suggest-meta">${book.author ?? "Inconnu"}</div>
                `;
            
                container.appendChild(div);
            });
        }
        
        loadBook();
        loadSuggestions();

    </script>

</body>
</html>
