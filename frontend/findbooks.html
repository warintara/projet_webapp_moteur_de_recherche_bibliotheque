<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DAAR E-Book Search</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<body class="search-page">
    
    <div class="page-wrapper">
        <h1 class="montype">DAAR E-Book Search</h1>

        <div class="search-container">
            <input type="text" id="searchInput" class="search-input"
                   placeholder="Tape une recherche (texte ou RegEx)...">
            <button class="button search-button" id="searchBtn">Search</button>
        </div>

        <div class="center-button">
            <button class="button back-main-button"
                    onclick="window.location.href='Index.html'">
                Go back to main page
            </button>
        </div>

    </div>
<script>
    const input = document.getElementById("searchInput");
    const btn   = document.getElementById("searchBtn");

    // Détection : regex si contient un opérateur
    function isRegex(q) {
        const specials = new Set(['*', '+', '|', '.', '(', ')']);
        for (const c of q) if (specials.has(c)) return true;
        return false;
    }

    // Fonction de nettoyage : supprime les accents morts et caractères UTF invisibles
    function cleanString(str) {
        return str
            .normalize("NFKD")                      // décompose les accents
            .replace(/[\u0300-\u036f]/g, "")        // supprime les accents morts
            .replace(/[\u0000-\u001F\u007F]/g, "")  // supprime caractères de contrôle
            .replace(/[^\x20-\x7E]/g, "");          // supprime UTF-8 non imprimables
    }

    function goSearch() {
        let q = input.value.trim();
        if (!q) return;

        q = cleanString(q);

        const isR = isRegex(q);

        window.location.href =
            "results.html?q=" + encodeURIComponent(q) +
            "&regex=" + (isR ? "1" : "0") +
            "&page=1";
    }

    btn.addEventListener("click", goSearch);

    input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") goSearch();
    });
</script>

</div>
</body>
</html>
